import os
import yaml
from google.oauth2 import service_account
from googleapiclient.discovery import build
from googleapiclient.http import MediaFileUpload


def load_config():
    with open("config.yaml", "r") as file:
        config = yaml.safe_load(file)
    return config


config = load_config()


def authenticate_google_drive():
    credentials = service_account.Credentials.from_service_account_file(
        config["google_drive"]["SERVICE_ACCOUNT_FILE"],
        scopes=["https://www.googleapis.com/auth/drive"],
    )
    drive_service = build("drive", "v3", credentials=credentials)
    return drive_service


def upload_to_google_drive(drive_service, file_path, folder_id):
    file_metadata = {"name": os.path.basename(file_path), "parents": [folder_id]}
    media = (
        drive_service.files()
        .create(body=file_metadata, media_body=file_path, fields="id, webContentLink")
        .execute()
    )

    file_id = media.get("id")
    web_content_link = media.get("webContentLink")

    print(f"File ID: {file_id}")
    print(f"Web Content Link: {web_content_link}")

    return web_content_link
