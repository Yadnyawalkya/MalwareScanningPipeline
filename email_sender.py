import smtplib
from email.mime.text import MIMEText
from email.mime.multipart import MIMEMultipart
import yaml


def load_config():
    with open("config.yaml", "r") as file:
        config = yaml.safe_load(file)
    return config


config = load_config()["email_sender"]


def send_email(subject, body):
    message = MIMEMultipart()
    message["From"] = f'{config["SENDER_NAME"]} <{config["SENDER_EMAIL"]}>'
    message["To"] = config["RECIPIENT_EMAIL"]
    message["Subject"] = subject
    message.attach(MIMEText(body, "plain"))
    with smtplib.SMTP("smtp.gmail.com", 587) as server:
        server.starttls()
        server.login(config["SENDER_EMAIL"], config["APP_PASSWORD"])
        server.sendmail(
            config["SENDER_EMAIL"], config["RECIPIENT_EMAIL"], message.as_string()
        )
    print("Email sent successfully!")
